<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply | The Silent Court</title>
    <link rel="stylesheet" href="style.css?v=1.7">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>

    <nav>
        <div class="logo">The Silent Court</div>
        <ul>
            <li><a href="https://discord.gg/zekszdRAUz" target="_blank">Discord</a></li>
        </ul>
    </nav>

    <div class="apply-wrapper">
        <div class="form-container">
            <h2>Guild Member Application</h2>
            <form id="applyForm">
                <input type="text" id="username" placeholder="Roblox Username & Discord Tag" required>
                
                <div class="form-divider">Fabled Legacy Stats</div>
                
                <label style="display:block; margin-bottom:5px; font-size:0.8rem; color:#c9a86a;">What level are you? (Please upload a screenshot)</label>
                <input type="number" id="level" placeholder="Your Level" required>
                <input type="file" id="screenshot" accept="image/*" required style="font-size: 0.8rem; background: transparent; border: none; padding: 5px 0;">

                <input type="text" id="hours" placeholder="How many hours are you on per day?" required>
                <input type="text" id="class" placeholder="What class are you?" required>

                <div class="form-divider">Contribution</div>
                <textarea id="raids" placeholder="Do you host raids of any sort?" rows="3" required></textarea>
                <textarea id="quests" placeholder="How many quests do you think you will contribute to each day?" rows="3" required></textarea>
                
                <button type="submit" id="submitBtn" class="btn">Submit Application</button>
            </form>
        </div>
    </div>

    <script>
        const form = document.getElementById('applyForm');
        const btn = document.getElementById('submitBtn');

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            btn.innerText = "Sending to the Court...";
            btn.disabled = true;

            const webhookURL = "https://small-violet-2077.niklashelmis10.workers.dev/";
            
            let screenshotData = "";
            const file = document.getElementById('screenshot').files[0];
            if (file) {
                screenshotData = await toBase64(file);
            }

            const payload = {
                embeds: [{
                    title: "⚖️ New Guild Member Application",
                    color: 13215850,
                    fields: [
                        { name: "User", value: document.getElementById('username').value, inline: true },
                        { name: "Level", value: document.getElementById('level').value, inline: true },
                        { name: "Hours daily", value: document.getElementById('hours').value, inline: true },
                        { name: "Class", value: document.getElementById('class').value, inline: true },
                        { name: "Hosts Raids?", value: document.getElementById('raids').value },
                        { name: "Daily Quests Contribution", value: document.getElementById('quests').value }
                    ],
                    image: {
                        url: "attachment://screenshot.png"
                    },
                    footer: { text: "The Silent Court Recruitment" },
                    timestamp: new Date()
                }]
            };
            
            fetch(webhookURL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }).then(() => {
                alert('Success! Your application has been sent to The Silent Court.');
                form.reset();
                btn.innerText = "Submit Application";
                btn.disabled = false;
            }).catch(err => {
                alert('Error sending application.');
                btn.innerText = "Submit Application";
                btn.disabled = false;
            });
        });
    </script>
</body>
</html>
